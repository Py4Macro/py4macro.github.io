Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/jupyter_cache/executors/utils.py", line 58, in single_nb_execution
    executenb(
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/nbclient/client.py", line 1319, in execute
    return NotebookClient(nb=nb, resources=resources, km=km, **kwargs).execute()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/jupyter_core/utils/__init__.py", line 165, in wrapped
    return loop.run_until_complete(inner)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 691, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/nbclient/client.py", line 709, in async_execute
    await self.async_execute_cell(
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/nbclient/client.py", line 1062, in async_execute_cell
    await self._check_raise_for_error(cell, cell_index, exec_reply)
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/nbclient/client.py", line 918, in _check_raise_for_error
    raise CellExecutionError.from_cell_and_msg(cell, exec_reply_content)
nbclient.exceptions.CellExecutionError: An error occurred while executing the following cell:
------------------
# ãƒ‡ãƒ¼ã‚¿
df = py4macro.data('pwt')

# æœ€æ–°å¹´
latest_year = df['year'].max()

# ä¸€äººå½“ãŸã‚ŠGDP
df['naGDPpc'] = df['rgdpna']/df['pop']

# 1960ã‚’é–¾å€¤ã¨ã™ã‚‹
first_yr = 1960
df_growth = df.query('year >= @first_yr').copy()

# yrä»¥é™ã§å…¨ã¦ã®å¹´ã§GDPã®ãƒ‡ãƒ¼ã‚¿ã‚ã‚‹å›½ãƒ»åœ°åŸŸã‚’æŠ½å‡º
notna_check = lambda x: x.notna().all()
cond = df_growth[['country','year','naGDPpc']].groupby('country')['naGDPpc'].transform(notna_check)
df_growth = df_growth.loc[cond,:]

# æˆé•·ç‡ã®è¨ˆç®—
def fun(col):
    return 100 * ( (col.iat[-1]/col.iat[0])**(1/(len(col)-1))-1 )
growth = df_growth.groupby('country')[['naGDPpc']].agg(fun)

# # æ—¥æœ¬ã®å¹³å‡æˆé•·ç‡
jp_growth = growth.loc['Japan',:][0]

# # ãƒ—ãƒ­ãƒƒãƒˆ
fig, ax = plt.subplots(figsize=(6,4), tight_layout=True)
ax.hist(growth, bins=22, edgecolor='black', linewidth=1.2)
ax.axvline(jp_growth, c='red')
ax.set_ylabel('å›½ã®æ•°', size=15)
ax.set_title(f'{yr}-{latest_year}å¹´ï¼Œ{len(growth)}ã®å›½ãƒ»åœ°åŸŸ, PWT11.0', size=16)
fig.suptitle(f'ï¼‘äººå½“ãŸã‚Šå®Ÿè³ªGDPã®å¹³å‡æˆé•·ç‡(ï¼…)ã®åˆ†å¸ƒ', size=20)
pass
------------------


[31m---------------------------------------------------------------------------[39m
[31mNameError[39m                                 Traceback (most recent call last)
[36mCell[39m[36m [39m[32mIn[3][39m[32m, line 32[39m
[32m     30[39m ax.axvline(jp_growth, c=[33m'[39m[33mred[39m[33m'[39m)
[32m     31[39m ax.set_ylabel([33m'[39m[33må›½ã®æ•°[39m[33m'[39m, size=[32m15[39m)
[32m---> [39m[32m32[39m ax.set_title([33mf[39m[33m'[39m[38;5;132;01m{[39;00m[43myr[49m[38;5;132;01m}[39;00m[33m-[39m[38;5;132;01m{[39;00mlatest_year[38;5;132;01m}[39;00m[33må¹´ï¼Œ[39m[38;5;132;01m{[39;00m[38;5;28mlen[39m(growth)[38;5;132;01m}[39;00m[33mã®å›½ãƒ»åœ°åŸŸ, PWT11.0[39m[33m'[39m, size=[32m16[39m)
[32m     33[39m fig.suptitle([33mf[39m[33m'[39m[33mï¼‘äººå½“ãŸã‚Šå®Ÿè³ªGDPã®å¹³å‡æˆé•·ç‡(ï¼…)ã®åˆ†å¸ƒ[39m[33m'[39m, size=[32m20[39m)
[32m     34[39m [38;5;28;01mpass[39;00m

[31mNameError[39m: name 'yr' is not defined

